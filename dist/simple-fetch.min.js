!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.SimpleFetch={})}(this,function(e){"use strict";function r(e){var r=null,t=new Promise(function(e,t){r=function(e){t(e||"fetch aborted")}}),n=Promise.race([e,t]);return n.abort=r,n}function t(e,r){return r&&g.indexOf(r)>0?e[r]():e.text()}var n=function(e,r){return r={exports:{}},e(r,r.exports),r.exports}(function(e,r){var t=Object.prototype.hasOwnProperty,n=function(){for(var e=[],r=0;256>r;++r)e.push("%"+((16>r?"0":"")+r.toString(16)).toUpperCase());return e}(),o=function(e){for(var r;e.length;){var t=e.pop();if(r=t.obj[t.prop],Array.isArray(r)){for(var n=[],o=0;r.length>o;++o)void 0!==r[o]&&n.push(r[o]);t.obj[t.prop]=n}}return r};r.arrayToObject=function(e,r){for(var t=r&&r.plainObjects?Object.create(null):{},n=0;e.length>n;++n)void 0!==e[n]&&(t[n]=e[n]);return t},r.merge=function(e,n,o){if(!n)return e;if("object"!=typeof n){if(Array.isArray(e))e.push(n);else{if("object"!=typeof e)return[e,n];(o.plainObjects||o.allowPrototypes||!t.call(Object.prototype,n))&&(e[n]=!0)}return e}if("object"!=typeof e)return[e].concat(n);var i=e;return Array.isArray(e)&&!Array.isArray(n)&&(i=r.arrayToObject(e,o)),Array.isArray(e)&&Array.isArray(n)?(n.forEach(function(n,i){t.call(e,i)?e[i]&&"object"==typeof e[i]?e[i]=r.merge(e[i],n,o):e.push(n):e[i]=n}),e):Object.keys(n).reduce(function(e,i){var c=n[i];return e[i]=t.call(e,i)?r.merge(e[i],c,o):c,e},i)},r.assign=function(e,r){return Object.keys(r).reduce(function(e,t){return e[t]=r[t],e},e)},r.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(r){return e}},r.encode=function(e){if(0===e.length)return e;for(var r="string"==typeof e?e:e+"",t="",o=0;r.length>o;++o){var i=r.charCodeAt(o);45!==i&&46!==i&&95!==i&&126!==i&&(48>i||i>57)&&(65>i||i>90)&&(97>i||i>122)?128>i?t+=n[i]:2048>i?t+=n[192|i>>6]+n[128|63&i]:i>=55296&&57344>i?(i=65536+((1023&i)<<10|1023&r.charCodeAt(o+=1)),t+=n[240|i>>18]+n[128|i>>12&63]+n[128|i>>6&63]+n[128|63&i]):t+=n[224|i>>12]+n[128|i>>6&63]+n[128|63&i]:t+=r.charAt(o)}return t},r.compact=function(e){for(var r=[{obj:{o:e},prop:"o"}],t=[],n=0;r.length>n;++n)for(var i=r[n],c=i.obj[i.prop],a=Object.keys(c),u=0;a.length>u;++u){var f=a[u],l=c[f];"object"==typeof l&&null!==l&&-1===t.indexOf(l)&&(r.push({obj:c,prop:f}),t.push(l))}return o(r)},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},r.isBuffer=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}}),o=String.prototype.replace,i=/%20/g,c={default:"RFC3986",formatters:{RFC1738:function(e){return o.call(e,i,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},a={brackets:function(e){return e+"[]"},indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},u=Date.prototype.toISOString,f={delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},l=function e(r,t,o,i,c,a,u,l,s,p,d,y){var v=r;if("function"==typeof u)v=u(t,v);else if(v instanceof Date)v=p(v);else if(null===v){if(i)return a&&!y?a(t,f.encoder):t;v=""}if("string"==typeof v||"number"==typeof v||"boolean"==typeof v||n.isBuffer(v))return a?[d(y?t:a(t,f.encoder))+"="+d(a(v,f.encoder))]:[d(t)+"="+d(v+"")];var b=[];if(void 0===v)return b;var h;if(Array.isArray(u))h=u;else{var g=Object.keys(v);h=l?g.sort(l):g}for(var j=0;h.length>j;++j){var m=h[j];c&&null===v[m]||(b=b.concat(Array.isArray(v)?e(v[m],o(t,m),o,i,c,a,u,l,s,p,d,y):e(v[m],t+(s?"."+m:"["+m+"]"),o,i,c,a,u,l,s,p,d,y)))}return b},s=function(e,r){var t=e,o=r?n.assign({},r):{};if(null!==o.encoder&&void 0!==o.encoder&&"function"!=typeof o.encoder)throw new TypeError("Encoder has to be a function.");var i=void 0===o.delimiter?f.delimiter:o.delimiter,u="boolean"==typeof o.strictNullHandling?o.strictNullHandling:f.strictNullHandling,s="boolean"==typeof o.skipNulls?o.skipNulls:f.skipNulls,p="boolean"==typeof o.encode?o.encode:f.encode,d="function"==typeof o.encoder?o.encoder:f.encoder,y="function"==typeof o.sort?o.sort:null,v=void 0!==o.allowDots&&o.allowDots,b="function"==typeof o.serializeDate?o.serializeDate:f.serializeDate,h="boolean"==typeof o.encodeValuesOnly?o.encodeValuesOnly:f.encodeValuesOnly;if(void 0===o.format)o.format=c.default;else if(!Object.prototype.hasOwnProperty.call(c.formatters,o.format))throw new TypeError("Unknown format option provided.");var g,j,m=c.formatters[o.format];"function"==typeof o.filter?t=(j=o.filter)("",t):Array.isArray(o.filter)&&(g=j=o.filter);var O=[];if("object"!=typeof t||null===t)return"";var A,k=a[A=o.arrayFormat in a?o.arrayFormat:"indices"in o?o.indices?"indices":"repeat":"indices"];g||(g=Object.keys(t)),y&&g.sort(y);for(var x=0;g.length>x;++x){var C=g[x];s&&null===t[C]||(O=O.concat(l(t[C],C,k,u,s,p?d:null,j,y,v,b,m,h)))}var w=O.join(i);return w.length>0?(!0===o.addQueryPrefix?"?":"")+w:""},p=Object.assign||function(e){for(var r=1;arguments.length>r;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},d=function(){},y=function(e){return"[object Error]"===Object.prototype.toString.call(e)},v={},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.headers,o=void 0===n?{}:n,i=e.credentials,c=e.timeout,a=e.type,u=e.callbacks,f=void 0===u?{}:u,l=f.onStart,b=void 0===l?d:l,h=f.onComplete,g=void 0===h?d:h,j=f.onSuccess,m=void 0===j?d:j,O=f.onError,A=void 0===O?d:O,k=f.onSuccessFilter,x=void 0===k?function(e){return e}:k;c=c||v.timeout,a=a||v.type;var C=v.headers?p({},v.headers,o):o,w=p({},v,{headers:C});return i&&(w.credentials=i),function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.indexOf(" ")?e.split(/\s+/):["GET",e],i=o[0],u=o[1],f=v.body?p({},v.body,n):n;"GET"!==i&&(w.method=i),f=JSON.parse(JSON.stringify(f)),Object.keys(f).length&&("GET"!==i.toUpperCase()?w.body=JSON.stringify(f):u+="?"+s(f));var l=new Promise(function(e,r){b(),fetch(u,w).then(function(n){if(n.ok){var o=x(t(n,a)),i=n.headers;y(o)?(A(o),g(o),r(o)):(m(o),g(null,o),e({result:o,headers:i}))}else{var c=Error(n.statusText);A(c),g(c),r(c)}},function(e){A(e),g(e),r(e)})}),h={};return h.success=function(e){return e="function"==typeof e?e:d,l.then(function(r){e(r.result,r.headers)},d),h},h.error=function(e){return e="function"==typeof e?e:d,l.then(d,e),h},h.complete=function(e){return e="function"==typeof e?e:d,l.then(function(r){e(null,r)},e),h},h.abort=r(l).abort,c&&setTimeout(function(){h.abort("fetch timeout")},c),h}},h=b(),g=["text","json","blob","arrayBuffer","formData"];e.globalConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(e).forEach(function(r){v[r]=e[r]})},e.createRequest=b,e.request=h,Object.defineProperty(e,"__esModule",{value:!0})});
