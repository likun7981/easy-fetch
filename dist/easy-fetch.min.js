!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.SimpleFetch={})}(this,function(e){"use strict";var t=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};require("isomorphic-fetch");var o=require("qs/lib/stringify"),n=function(){},r={},i=["body","timeout","headers","onSuccess","onComplete","successFilter","onError","onStart"],c=void 0;e.createRequest=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.headers,u=void 0===i?{}:i,s=e.credentials,f=e.timeout,a=void 0===f?5e3:f,l=e.onStart,d=void 0===l?r.onStart||n:l,h=e.onComplete,v=void 0===h?r.onComplete||n:h,p=e.onSuccess,m=void 0===p?r.onSuccess||n:p,b=e.onError,y=void 0===b?r.onError||n:b,g=e.successFilter,S=void 0===g?r.successFilter||function(e){return Promise.resolve(e)}:g;a=void 0!==a?a:r.timeout;var E=r.headers?t({},r.headers,u):u,O=t({},r,{headers:E});return s&&(O.credentials=s),function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=e.indexOf(" ")>0?e.split(/\s+/):["GET",e],s=u[0],f=u[1],l=r.body?t({},r.body,i):i;"GET"!==s&&(O.method=s),l=JSON.parse(JSON.stringify(l)),Object.keys(l).length&&("GET"!==s.toUpperCase()?O.body=JSON.stringify(l):f+="?"+o(l));var h=void 0,p=new Promise(function(e,t){d(),(h=function(e){var t=null,o=new Promise(function(e,o){t=function(e){var t=Error(e||"fetch canceled");e?t.isTimeout=!0:(t.isAbort=!0,console.warn(t.message),clearTimeout(c)),o(t)}}),r=Promise.race([e,o]);return r.abort=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;"function"==typeof e&&(o=e,e=null),o(),t(e)},r}(fetch(f,O))).then(function(o){if(clearTimeout(c),o.ok){var n=o.headers;S(o).then(function(t){m(t),v(null,t),e({result:t,headers:n})},function(e){y(e),v(e),t(e)}).catch(t)}else{var r=Error(o.statusText);y(r),v(r),t(r)}},function(e){clearTimeout(c),e&&e.isAbort||(y(e),v(e)),t(e)}).catch(t)}),b={};return b.success=function(e){return e="function"==typeof e?e:n,p.then(function(t){e(t.result,t.headers)},n),b},b.error=function(e){return e="function"==typeof e?e:n,p.then(null,function(t){t&&t.isAbort||e(t)}),b},b.complete=function(e){return e="function"==typeof e?e:n,p.then(function(){e(null,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).result)},function(t){t&&t.isAbort||e(t)}),b},b.abort=h.abort,b.catch=p.catch,void 0!==a&&(c=setTimeout(function(){b.abort("fetch timeout")},a)),b}},e.globalConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.forEach(function(t){r[t]=e[t]})},Object.defineProperty(e,"__esModule",{value:!0})});
