!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.SimpleFetch={})}(this,function(e){"use strict";var t=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};require("isomorphic-fetch");var o=require("qs/lib/stringify"),n=function(){},r={},i=["body","timeout","headers","onSuccess","onComplete","successFilter","onError","onStart"],c=void 0;e.createRequest=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.headers,s=void 0===i?{}:i,u=e.credentials,a=e.timeout,f=void 0===a?5e3:a,l=e.onStart,d=void 0===l?r.onStart||n:l,h=e.onComplete,v=void 0===h?r.onComplete||n:h,m=e.onSuccess,p=void 0===m?r.onSuccess||n:m,b=e.onError,y=void 0===b?r.onError||n:b,g=e.successFilter,S=void 0===g?r.successFilter||function(e){return Promise.resolve(e)}:g;f=void 0!==f?f:r.timeout;var E=r.headers?t({},r.headers,s):s,O=t({},r,{headers:E});return u&&(O.credentials=u),function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e.indexOf(" ")>0?e.split(/\s+/):["GET",e],u=s[0],a=s[1],l=r.body?t({},r.body,i):i;"GET"!==u&&(O.method=u),l=JSON.parse(JSON.stringify(l)),Object.keys(l).length&&("GET"!==u.toUpperCase()?O.body=JSON.stringify(l):a+="?"+o(l));var h=void 0,m=new Promise(function(e,t){d(),(h=function(e){var t=null,o=new Promise(function(e,o){t=function(e){var t=Error(e||"fetch canceled");e?t.isTimeout=!0:(t.isAbort=!0,console.warn(t.message),clearTimeout(c)),o(t)}}),n=Promise.race([e,o]);return n.abort=t,n}(fetch(a,O))).then(function(o){if(clearTimeout(c),o.ok){var n=o.headers;S(o).then(function(t){p(t),v(null,t),e({result:t,headers:n})},function(e){y(e),v(e),t(e)}).catch(t)}else{var r=Error(o.statusText);y(r),v(r),t(r)}},function(e){clearTimeout(c),e&&e.isAbort||(y(e),v(e)),t(e)}).catch(t)}),b={};return b.success=function(e){return e="function"==typeof e?e:n,m=m.then(function(t){e(t.result,t.headers)}),b},b.error=function(e){return e="function"==typeof e?e:n,m=m.then(null,function(t){t&&t.isAbort||e(t)}),b},b.complete=function(e){return e="function"==typeof e?e:n,m=m.then(function(){e(null,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).result)},function(t){t&&t.isAbort||e(t)}),b},b.abort=h.abort,b.catch=m.catch,void 0!==f&&(c=setTimeout(function(){console.log("timeout"),b.abort("fetch timeout")},f)),b}},e.globalConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.forEach(function(t){r[t]=e[t]})},Object.defineProperty(e,"__esModule",{value:!0})});
